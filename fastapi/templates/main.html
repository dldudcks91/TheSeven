<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- head ì„¹ì…˜ì— ì¶”ê°€ -->
    <script src="/templates/gameConfigManager.js"></script>
    <title>4X Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
        }
        
        .header {
            border-bottom: 1px solid #ccc;
            padding: 10px 20px;
            background: #f5f5f5;
        }
        
        .header input {
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .header button {
            padding: 5px 10px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .tabs {
            border-bottom: 1px solid #ccc;
            background: #f9f9f9;
        }
        
        .tab-button {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab-button.active {
            border-bottom: 2px solid #333;
            background: white;
        }
        
        .resource-tabs {
            display:flex;
            border-bottom: 1px solid #ccc;
            background: #f0f0f0;
            padding: 5px;
        }
        
        .resource-tab {
            display: inline-block;
            padding: 8px 15px;
            margin-right: 5px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 12px;
        }
        
        .resource-tab.active {
            background: #333;
            color: white;
        }
        
        .content {
            height: calc(100vh - 170px);
            overflow: hidden;
        }
        
        .tab-content {
            display: none;
            height: 100%;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* API í…ŒìŠ¤íŠ¸ íƒ­ */
        .api-test {
            padding: 20px;
        }
        
        .api-form {
            max-width: 500px;
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
        }
        
        .buttons {
            margin-bottom: 20px;
        }
        
        .buttons button {
            margin-right: 10px;
            padding: 8px 15px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
        }
        
        .result {
            padding: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        /* ê²Œì„ íƒ­ - 2ì—´ ë ˆì´ì•„ì›ƒ */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(3, 1fr);
            height: 100%;
            gap: 10px;
            padding: 10px;
            background: #f5f5f5;
        }
        
        .game-section {
            background: white;
            padding: 15px;
            overflow: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-section h3 {
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        
        .refresh-btn {
            float: right;
            padding: 2px 8px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 11px;
            border-radius: 4px;
        }
        
        /* ê±´ë¬¼ ëª©ë¡ */
        .building-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .building-table th,
        .building-table td {
            padding: 5px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .building-table th {
            background: #f5f5f5;
        }
        
        .building-table button {
            padding: 2px 6px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 10px;
            margin-right: 2px;
            border-radius: 3px;
        }
        
        /* ì—°êµ¬ ëª©ë¡ */
        .research-list {
            font-size: 12px;
        }
        
        .research-item {
            border: 1px solid #ddd;
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        .research-item h4 {
            margin: 0 0 5px 0;
        }
        
        /* ìì› í‘œì‹œ */
        .resource-content {
            display: none;
            padding: 10px;
            background: white;
        }
        
        .resource-content.active {
            display: block;
        }
        
        .resource-info {
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .resource-amount {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .resource-buttons button {
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        /* ìœ ë‹› ëª©ë¡ */
        .unit-list {
            font-size: 12px;
        }
        
        .unit-item {
            border: 1px solid #ddd;
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        
        .toast {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            padding: 15px;
            position: relative;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left: 4px solid #28a745;
        }
        
        .toast.error {
            border-left: 4px solid #dc3545;
        }
        
        .toast.info {
            border-left: 4px solid #17a2b8;
        }
        
        .toast.warning {
            border-left: 4px solid #ffc107;
        }
        
        .toast-header {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #999;
            padding: 0;
            margin-left: 10px;
        }
        
        .toast-close:hover {
            color: #333;
        }
        
        .toast-body {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- í—¤ë” -->
    <div class="header">
        <label>í”Œë ˆì´ì–´ ID:</label>
        <input type="number" id="globalUserId" value="1" />
        <button onclick="loadAllData()">ì „ì²´ ë°ì´í„° ë¡œë“œ</button>
        <span style="margin-left: 20px;">í˜„ì¬ ì‹œê°„: <span id="currentTime"></span></span>
    </div>
    
    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tabs">
        <button class="tab-button active" onclick="showTab('api')">API í…ŒìŠ¤íŠ¸</button>
        <button class="tab-button" onclick="showTab('game')">ê²Œì„</button>
        <button class="tab-button" onclick="showTab('hero')">ì˜ì›…</button>
        <button class="tab-button" onclick="showTab('ally')">ì—°ë§¹</button>
    </div>
    
    <!-- ìì› íƒ­ -->
    <div class="resource-tabs" style="overflow: visible; position: relative; z-index: 100;">
        <iframe 
            id="resourceFrame" 
            src="resource.html" 
            style="width: calc(100% - 60px); height: 40px; border: none;">
        </iframe>
        <iframe 
            id="buffFrame" 
            src="buff.html" 
            style="width: 50px; height: 40px; border: none; overflow: visible;">
        </iframe>
        <!-- <div class="resource-tab active" >ì‹ëŸ‰: <span id="food-value">1000</span></div>
        <div class="resource-tab" >ê³¨ë“œ: <span id="gold-value">500</span></div>
        <div class="resource-tab" >ëª©ì¬: <span id="wood-value">800</span></div>
        <div class="resource-tab" >ì„ì¬: <span id="stone-value">300</span></div> -->
    </div>
    
    <!-- ì½˜í…ì¸  -->
    <div class="content">
        <!-- API í…ŒìŠ¤íŠ¸ íƒ­ -->
        <div id="tab-api" class="tab-content active">
            <div class="api-test">
                <div class="api-form">
                    <h3>API í…ŒìŠ¤íŠ¸</h3>
                    
                    <div class="form-group">
                        <label>í”Œë ˆì´ì–´ ID:</label>
                        <input type="number" id="apiUserId" value="1" />
                    </div>
                    <div class="form-group">
                        <label>API ì½”ë“œ:</label>
                        <input type="number" id="apiCode" value="2001" placeholder="ì˜ˆ: 2001, 3001" />
                    </div>
                    <div class="form-group">
                        <label>ë°ì´í„°:</label>
                        <input type="text" id="apiData" value="{}" placeholder="ì˜ˆ: unit_id: 300" />
                    </div>
                    
                    <div class="buttons">
                        <button onclick="callAPI()">API í˜¸ì¶œ</button>
                        <button onclick="clearResult()">ê²°ê³¼ ì§€ìš°ê¸°</button>
                    </div>
                </div>
                
                <div id="apiResult" class="result"></div>
            </div>
        </div>
        
        <!-- ê²Œì„ íƒ­ -->
        <div id="tab-game" class="tab-content">
            <div class="game-layout">
                <!-- ê±´ë¬¼ ê´€ë¦¬ (ì™¼ìª½ ìƒë‹¨) -->
                <div class="game-section">
                    
                    <iframe 
                        id="buildingFrame" 
                        src="building.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>
                
                <!-- ì—°êµ¬ ê´€ë¦¬ (ì˜¤ë¥¸ìª½ ìƒë‹¨) -->
                <div class="game-section">
                    
                    <iframe 
                        id="researchFrame" 
                        src="research.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>
                
                <!-- ìœ ë‹› ê´€ë¦¬ (ì™¼ìª½ ì¤‘ê°„) -->
                <div class="game-section">
                    
                    <iframe 
                        id="unitFrame" 
                        src="unit.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>
                
                <!-- ìì› ê´€ë¦¬ (ì˜¤ë¥¸ìª½ ì¤‘ê°„) -->
                <div class="game-section">
                    
                    <iframe 
                        id="itemFrame" 
                        src="item.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>
                
                 <!-- ì„ë¬´/í€˜ìŠ¤íŠ¸ (ì™¼ìª½ í•˜ë‹¨) -->
                <div class="game-section">
                    
                    <iframe 
                        id="missionFrame" 
                        src="mission.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>

                
                
                <!-- ìƒì /êµì—­ (ì˜¤ë¥¸ìª½ í•˜ë‹¨) -->
                <div class="game-section">
                    
                    <iframe 
                        id="shopFrame" 
                        src="shop.html" 
                        style="width: 100%; height: calc(100% - 0px); border: none;">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'api';
        let currentResource = 'food';
        
        let gameConfigManager = null;
        let gameConfig = null;
        let loadConfigPromise = null; // Promise ìºì‹œ
        
        // ========================================
        // WebSocket ê´€ë ¨
        // ========================================
        let websocket = null;
        let wsReconnectAttempts = 0;
        const WS_MAX_RECONNECT = 5;
        const WS_RECONNECT_DELAY = 3000;
        
        function connectWebSocket(userId) {
            if (!userId) return;
            
            // ê¸°ì¡´ ì—°ê²° ì •ë¦¬
            if (websocket) {
                websocket.onclose = null; 
                websocket.onerror = null;
                websocket.close();
            }
            
            const wsUrl = `ws://${window.location.host}/ws/${userId}`;
            console.log(`ğŸ”Œ WebSocket ì—°ê²°: ${wsUrl}`);
            
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = () => {
                console.log('âœ… WebSocket ì—°ê²° ì„±ê³µ');
                wsReconnectAttempts = 0;
                showToast('ì„œë²„ì™€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            };
            
            websocket.onmessage = (event) => {
                const message = JSON.parse(event.data);
                handleWebSocketMessage(message);
            };
            
            websocket.onclose = () => {
                console.log('ğŸ”Œ WebSocket ì—°ê²° ì¢…ë£Œ');
                if (wsReconnectAttempts < WS_MAX_RECONNECT) {
                    wsReconnectAttempts++;
                    setTimeout(() => {
                        const userId = document.getElementById('globalUserId').value;
                        if (userId) connectWebSocket(userId);
                    }, WS_RECONNECT_DELAY);
                }
            };
            
            websocket.onerror = (error) => {
                console.error('âŒ WebSocket ì—ëŸ¬:', error);
            };
        }
        
        function handleWebSocketMessage(message) {
            console.log('ğŸ“© WebSocket:', message);
            
            switch (message.type) {
                case 'connected':
                    console.log('ì„œë²„ ì—°ê²° í™•ì¸:', message.user_no);
                    break;
                    
                case 'unit_complete':
                    // ìœ ë‹› í›ˆë ¨ ì™„ë£Œ â†’ unit iframeì— ì „ë‹¬
                    const unitFrame = document.getElementById('unitFrame');
                    if (unitFrame) {
                        unitFrame.contentWindow.postMessage({
                            type: 'unit_complete',
                            payload: message.data
                        }, '*');
                    }
                    showToast(`ìœ ë‹› í›ˆë ¨ ì™„ë£Œ!`, 'success');
                    
                    // ë¯¸ì…˜ ì—…ë°ì´íŠ¸
                    if (message.data?.mission_update) {
                        const missionFrame = document.getElementById('missionFrame');
                        if (missionFrame) {
                            missionFrame.contentWindow.postMessage({
                                type: 'update_mission_ui',
                                payload: message.data.mission_update
                            }, '*');
                        }
                    }
                    break;
            }
        }

        // ì´ˆê¸° ì‹¤í–‰ í•¨ìˆ˜
        window.onload = function() {
            // Promise ìºì‹œ í™œìš© - ê²Œì„ ì„¤ì • ìë™ ë¡œë“œ
            
            if (!loadConfigPromise) {
                loadConfigPromise = loadGameConfig();
                
            }
        };
        
        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ WebSocket ì •ë¦¬
        window.onbeforeunload = function() {
            if (websocket) {
                websocket.close();
            }
        };

        // iframeì—ì„œ ê²Œì„ ì„¤ì • ìš”ì²­ì‹œ ì‘ë‹µ
        window.addEventListener('message', async(event) => {
            if (event.data && event.data.type === 'request_config') {
                const requestedType = event.data.configType;
                
                
                // gameConfigê°€ ì—†ìœ¼ë©´ ë¡œë“œ (Promise ì¬ì‚¬ìš©)
                if (!gameConfig) {
                    if (!loadConfigPromise) {
                        console.log("ê²Œì„ ì„¤ì • ë¡œë“œ ì‹œì‘...");
                        loadConfigPromise = loadGameConfig();
                    } else {
                        console.log("ê²Œì„ ì„¤ì • ë¡œë“œ ì¤‘... ê¸°ë‹¤ë¦½ë‹ˆë‹¤.");
                    }
                    await loadConfigPromise;
                }



                let dataToSend = null;
                if (gameConfig && gameConfig[requestedType]) {
                    dataToSend = gameConfig[requestedType];
                    console.log("postMessage", requestedType, dataToSend)
                }
                
                event.source.postMessage({
                    type: 'response_config',
                    payload: dataToSend
                }, event.origin);
                

                
            }
            if (event.data.type === 'refresh_item') {
                // item iframe ì°¾ì•„ì„œ ë©”ì‹œì§€ ì „ë‹¬
                const itemFrame = document.getElementById('itemFrame');
                if (itemFrame) {
                    itemFrame.contentWindow.postMessage({ type: 'refresh_items' }, '*');
                }
            }
            if (event.data.type === 'update_mission') {
                
                const missionFrame = document.getElementById('missionFrame');
                if (missionFrame) {
                    missionFrame.contentWindow.postMessage({
                        type: 'update_mission_ui',
                        payload: event.data.payload
                    }, '*');
                }
            }


        });

        

        // ê²Œì„ ì„¤ì • ë¡œë“œ
        async function loadGameConfig() {
            gameConfigManager = GameConfigManager.getInstance();
            gameConfig = await gameConfigManager.loadGameConfig();
            
            console.log('ê²Œì„ ì„¤ì • ë¡œë“œ ì™„ë£Œ:', gameConfig);
            showToast('ê²Œì„ ì„¤ì •ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            
            return gameConfig;
            // try {
            //     gameConfigManager = GameConfigManager.getInstance();
            //     gameConfig = await gameConfigManager.loadGameConfig();
                
            //     console.log('ê²Œì„ ì„¤ì • ë¡œë“œ ì™„ë£Œ:', gameConfig);
            //     showToast('ê²Œì„ ì„¤ì •ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                
            //     return gameConfig;
            // } catch (error) {
            //     console.error('ê²Œì„ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            //     showToast('ê²Œì„ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
            //     return null;
            // }
        }
        
        // ì „ì²´ ë°ì´í„° ë¡œë“œ - ì´ë•Œë§Œ iframeì— í”Œë ˆì´ì–´ ID ì „ì†¡
        async function loadAllData() {
            const userId = document.getElementById('globalUserId').value;
            if (!userId) {
                showToast('í”Œë ˆì´ì–´ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'warning');
                return;
            }
            
            showToast('ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            
            // 1. ì„œë²„ì— ìºì‹œ í”„ë¦¬ë¡œë“œ ìš”ì²­ (api_code: 1010)
            const cacheResponse = await preloadServerCache(userId);
            
            // 2. WebSocket ì—°ê²°
            connectWebSocket(userId);
            
            // 3. ëª¨ë“  iframeì— í”Œë ˆì´ì–´ ID ì „ë‹¬
            const frameIds = ['buildingFrame', 'researchFrame','unitFrame','resourceFrame','missionFrame','itemFrame','shopFrame','buffFrame'];
            
            frameIds.forEach(frameId => {
                const frame = document.getElementById(frameId);
                if (frame && frame.contentWindow) {
                    try {
                        frame.contentWindow.postMessage({
                            type: 'set_player_id',
                            userId: userId
                        }, '*');
                        
                    } catch (error) {
                        console.warn(`${frameId}ì— ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:`, error);
                    }
                }
            });
            
            // await Promise.all([
            //     loadResearch(),
            //     loadResources(),
            // ]);
            
            showToast('ì „ì²´ ë°ì´í„° ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // ì„œë²„ ìºì‹œ í”„ë¦¬ë¡œë“œ ìš”ì²­ í•¨ìˆ˜
        async function preloadServerCache(userId) {
            
            const gameData = {
                user_no: parseInt(userId),
                api_code: 1010,  // ìºì‹œ í”„ë¦¬ë¡œë“œ API ì½”ë“œ
                data: {}
            };
            
            console.log('ì„œë²„ ìºì‹œ í”„ë¦¬ë¡œë“œ ìš”ì²­:', gameData);
            
            const response = await fetch('/api', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(gameData)
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            console.log('ì„œë²„ ìºì‹œ í”„ë¦¬ë¡œë“œ ì‘ë‹µ:', result);
            
            return result;
                
            
        }
        // í”Œë ˆì´ì–´ ID ë³€ê²½ì‹œ ì²˜ë¦¬ - ë©”ì‹œì§€ ì „ì†¡í•˜ì§€ ì•ŠìŒ
        document.getElementById('globalUserId').addEventListener('input', function() {
            const userId = this.value;
            document.getElementById('apiUserId').value = userId;
            // iframe ë©”ì‹œì§€ ì „ì†¡ ì œê±°ë¨ - ì „ì²´ ë°ì´í„° ë¡œë“œì—ì„œë§Œ ì²˜ë¦¬
        });

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
        function showToast(message, type = 'info', title = '') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const toastId = Date.now();
            toast.innerHTML = `
                <div class="toast-header">
                    <span>${title || getToastTitle(type)}</span>
                    <button class="toast-close" onclick="closeToast(${toastId})">&times;</button>
                </div>
                <div class="toast-body">${message}</div>
            `;
            
            toast.id = `toast-${toastId}`;
            container.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                closeToast(toastId);
            }, 5000);
        }
        
        function getToastTitle(type) {
            switch(type) {
                case 'success': return 'ì„±ê³µ';
                case 'error': return 'ì˜¤ë¥˜';
                case 'warning': return 'ê²½ê³ ';
                default: return 'ì•Œë¦¼';
            }
        }
        
        function closeToast(toastId) {
            const toast = document.getElementById(`toast-${toastId}`);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }
        
        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
            currentTab = tabName;
        }
        
        // ìì› íƒ­ ì „í™˜
        function showResource(resourceType) {
            document.querySelectorAll('.resource-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.resource-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(`resource-${resourceType}`).classList.add('active');
            currentResource = resourceType;
        }
        
        // ìì› ì¶”ê°€/ì œê±°
        function addResource(resourceType, amount) {
            const currentAmount = parseInt(document.getElementById(`${resourceType}-amount`).textContent);
            const newAmount = Math.max(0, currentAmount + amount);
            
            document.getElementById(`${resourceType}-amount`).textContent = newAmount;
            document.getElementById(`${resourceType}-value`).textContent = newAmount;
        }
        
        
        
        // ìì› ë°ì´í„° ë¡œë“œ
        async function loadResources() {
            const userId = document.getElementById('globalUserId').value;
            
            if (!userId) return;
            
            // í˜„ì¬ ê°’ë“¤ ìœ ì§€
            const food = document.getElementById('food-amount').textContent;
            const gold = document.getElementById('gold-amount').textContent;
            const wood = document.getElementById('wood-amount').textContent;
            const stone = document.getElementById('stone-amount').textContent;
            
            document.getElementById('food-value').textContent = food;
            document.getElementById('gold-value').textContent = gold;
            document.getElementById('wood-value').textContent = wood;
            document.getElementById('stone-value').textContent = stone;
        }
        
        // API í˜¸ì¶œ
        async function callAPI() {
            const resultDiv = document.getElementById('apiResult');
            
            try {
                const gameData = {
                    user_no: parseInt(document.getElementById('apiUserId').value),
                    api_code: parseInt(document.getElementById('apiCode').value),
                    data: JSON.parse(document.getElementById('apiData').value)
                };
                
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ìš”ì²­ ì¤‘...';
                
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gameData)
                });

                const result = await response.json();
                resultDiv.textContent = `ê²°ê³¼:\n${JSON.stringify(result, null, 2)}`;
                
            } catch (error) {
                resultDiv.textContent = `ì—ëŸ¬: ${error.message}`;
            }
        }
        
        
        
        // ì„ë¬´ ì•¡ì…˜
        
        
        // ìƒì  ì•¡ì…˜
        function loadShop() {
            showToast('ìƒì  ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function buyItem(itemId) {
            showToast(`ì•„ì´í…œì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤: ${itemId}`, 'success');
        }
        
        // ê²°ê³¼ ì§€ìš°ê¸°
        function clearResult() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';
        }
    </script>
</body>
</html>