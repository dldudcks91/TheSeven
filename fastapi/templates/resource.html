<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자원 관리</title>
    <style>
        .resource-container {
            display: flex;
            
        }
        .resource-tab{
            margin-right: 20px;

        }
    </style>
    </style>
</head>
<body>
    <div class="resource-container" style = "display:flex">
        <div class="resource-tab" >식량: <span id="food-value">-</span></div>
        <div class="resource-tab" >목재: <span id="wood-value">-</span></div>
        <div class="resource-tab" >석재: <span id="stone-value">-</span></div>
        <div class="resource-tab" >골드: <span id="gold-value">-</span></div>
        <div class="resource-tab" >루비: <span id="gold-value">-</span></div>
    </div>
</body>
<script>
    let userId = null;

    window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'set_player_id') {
                const newUserId = event.data.userId;
                
                if (userId !== newUserId) {
                    userId = newUserId;
                    loadResource();
                }
            }

            
        });
    window.onload = function() {
            
            
            
            setTimeout(() => {
                if (userId) {
                    loadResource();
                }
            }, 100);
        };
    async function loadResource() {
            if (!userId) {
                console.log('Resource 플레이어 ID가 설정되지 않았습니다.');
                return;
            }
            
            userResourceData = {};
            
            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_no: parseInt(userId),
                        api_code: 1011,
                        data: {}
                    })
                });
                
                const result = await response.json();
                if (result.success && result.data) {
                    userResourceData = result.data;
                }
                console.log('loadResource - userResourceData: ',userResourceData, result)
                
                document.getElementById('food-value').innerText = formatNumber(userResourceData.food)
                document.getElementById('wood-value').innerText = formatNumber(userResourceData.wood)
                document.getElementById('stone-value').innerText = formatNumber(userResourceData.stone)
                document.getElementById('gold-value').innerText = formatNumber(userResourceData.gold)
                document.getElementById('ruby-value').innerText = formatNumber(userResourceData.ruby)
                
                
                console.log('REsource 정보 로드 성공:', userResourceData)
                
            } catch (error) {
                console.log('Resource 정보 로드 실패:', error);
                
                

            }
        }
    function formatNumber(num) {
        if (num >= 1000000000) {
            return (num / 1000000000).toFixed(1) + 'B'; // 10억 이상: B (Billion)
        }
        if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + 'M'; // 100만 이상: M (Million)
        }
        if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K'; // 1000 이상: K (Thousand)
        }
        return num; // 1000 미만: 그대로 반환
        }
   

</script>