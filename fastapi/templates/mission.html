<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎØ∏ÏÖò Í¥ÄÎ¶¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            padding: 10px;
            background-color: white;
            margin: 0;
        }
        
        .game-section h3 {
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
            font-size: 16px;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
        }
        
        .mission-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            margin-top: 10px;
        }
        
        .mission-table th,
        .mission-table td {
            padding: 8px 10px;
            text-align: left;
            border: 1px solid #ddd;
            line-height: 1.4;
        }
        
        .mission-table th {
            background-color: #f8f8f8;
            font-weight: bold;
            font-size: 11px;
            text-align: center;
        }
        
        .mission-table th:nth-child(1) { width: 5%; text-align: center; }
        .mission-table th:nth-child(2) { width: 25%; }
        .mission-table th:nth-child(3) { width: 15%; text-align: center; }
        .mission-table th:nth-child(4) { width: 20%; text-align: center; }
        .mission-table th:nth-child(5) { width: 20%; text-align: center; }
        .mission-table th:nth-child(6) { width: 15%; text-align: center; }
        
        .mission-number {
            text-align: center;
            font-weight: bold;
            color: #666;
        }
        
        .mission-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .mission-title {
            font-weight: bold;
            color: #333;
            font-size: 12px;
        }
        
        .mission-category {
            font-size: 10px;
            color: #666;
        }
        
        .category-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            margin-right: 4px;
        }
        
        .category-building { background: #e3f2fd; color: #1976d2; }
        .category-research { background: #f3e5f5; color: #7b1fa2; }
        .category-unit { background: #fff3e0; color: #e65100; }
        .category-hero { background: #fce4ec; color: #c2185b; }
        .category-battle { background: #ffebee; color: #d32f2f; }
        
        .progress-cell {
            text-align: center;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 18px;
            background: #f0f0f0;
            border-radius: 9px;
            overflow: hidden;
            position: relative;
            border: 1px solid #ddd;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50 0%, #66bb6a 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: bold;
            color: #333;
            z-index: 1;
        }
        
        .rewards-cell {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .reward-item {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 3px 6px;
            background: #fff9e6;
            border: 1px solid #ffc107;
            border-radius: 3px;
            font-size: 10px;
        }
        
        .reward-icon {
            font-size: 12px;
        }
        
        .reward-amount {
            font-weight: bold;
            color: #f57c00;
        }
        
        .status-cell {
            text-align: center;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .status-locked {
            background: #f5f5f5;
            color: #999;
            border: 1px solid #e0e0e0;
        }
        
        .status-active {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196F3;
        }
        
        .status-claimable {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ff9800;
        }
        
        .status-completed {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .action-cell {
            text-align: center;
        }
        
        .claim-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .claim-btn.active {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }
        
        .claim-btn.active:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
        }
        
        .claim-btn:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }
        
        .row-locked {
            background-color: #fafafa;
            opacity: 0.6;
        }
        
        .row-completed {
            background-color: #f1f8f4;
        }
        
        .result-box {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            background: #f9f9f9;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 11px;
            display: none;
            max-height: 80px;
            overflow-y: auto;
        }
        
        .controls {
            margin-bottom: 10px;
            padding: 8px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .controls input {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 11px;
            flex: 1;
        }
        
        .controls button {
            padding: 6px 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .controls button:hover {
            background: #1976d2;
        }
        
        .summary-row {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .summary-row td {
            font-weight: bold;
            border-color: #5a67d8;
        }
        
        .progress-summary {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-summary-bar {
            flex: 1;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-summary-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s ease;
        }
        
        .progress-summary-text {
            font-size: 11px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-section">
            <h3>Mission</h3>
        </div>
        
        <table class="mission-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>ÎØ∏ÏÖò</th>
                    <th>Î™©Ìëú</th>
                    <th>ÏßÑÌñâÎèÑ</th>
                    <th>Î≥¥ÏÉÅ</th>
                    <th>ÏÉÅÌÉú</th>
                </tr>
            </thead>
            <tbody id="missionTableBody">
                <!-- ÎØ∏ÏÖòÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </tbody>
            <tfoot>
                <tr class="summary-row">
                    <td colspan="3" style="text-align: right;">Ï†ÑÏ≤¥ ÏßÑÌñâÎèÑ:</td>
                    <td colspan="3">
                        <div class="progress-summary">
                            <div class="progress-summary-bar">
                                <div class="progress-summary-fill" id="overallProgressBar" style="width: 0%"></div>
                            </div>
                            <span class="progress-summary-text">
                                <span id="completedCount">0</span>/<span id="totalCount">0</span> ÏôÑÎ£å
                            </span>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
        
        <div class="result-box" id="resultBox"></div>
    </div>

    <script>
        let userId = null;
        let missionConfig = {};
        let userMissionProgress = {};
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ï†ïÎ≥¥
        const categoryInfo = {
            'building': { icon: 'üèóÔ∏è', name: 'Í±¥Î¨º', class: 'category-building' },
            'research': { icon: 'üî¨', name: 'Ïó∞Íµ¨', class: 'category-research' },
            'unit': { icon: '‚öîÔ∏è', name: 'Ïú†Îãõ', class: 'category-unit' },
            'hero': { icon: 'ü¶∏', name: 'ÏòÅÏõÖ', class: 'category-hero' },
            'battle': { icon: '‚öîÔ∏è', name: 'Ï†ÑÌà¨', class: 'category-battle' },
            'resource': { icon: 'üåæ', name: 'ÏûêÏõê', class: 'category-resource' }
        };
        
        // Î≥¥ÏÉÅ ÏïÑÏù¥ÌÖú ÏïÑÏù¥ÏΩò Îß§Ìïë
        const rewardIcons = {
            '21001': { icon: 'üåæ', name: 'ÏãùÎüâ' },
            '21002': { icon: 'ü™µ', name: 'Î™©Ïû¨' },
            '21003': { icon: '‚õèÔ∏è', name: 'ÏÑùÏû¨' },
            '22001': { icon: 'üí∞', name: 'Í≥®Îìú' },
            '22002': { icon: 'üíé', name: 'Ï†¨' },
            '31001': { icon: 'üì¶', name: 'ÏùºÎ∞òÏÉÅÏûê' },
            '31002': { icon: 'üì¶', name: 'Í≥†Í∏âÏÉÅÏûê' },
            '31003': { icon: 'üì¶', name: 'Ìù¨Í∑ÄÏÉÅÏûê' },
            '111001': { icon: 'üé´', name: 'ÏÜåÌôòÍ∂å' },
            '112001': { icon: '‚≠ê', name: 'Í≤ΩÌóòÏπò' }
        };
        
        // ========================================
        // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà (Î∂ÄÎ™® Ï∞ΩÍ≥º ÌÜµÏã†)
        // ========================================
        
        window.addEventListener('message', function(event) {
            // Ïú†Ï†Ä ID ÏÑ§Ï†ï
            
            if (event.data && event.data.type === 'set_player_id') {
                const newUserId = event.data.userId;
                
                if (userId !== newUserId) {
                    userId = newUserId;
                    console.log('üë§ User ID ÏÑ§Ï†ï:', userId);
                }    
                // ConfigÍ∞Ä Ïù¥ÎØ∏ Î°úÎìúÎêòÏñ¥ ÏûàÏúºÎ©¥ ÎØ∏ÏÖò Î°úÎìú
                if (Object.keys(missionConfig).length > 0) {
                    loadMissions();

                }
                
            }
            
            // Config Îç∞Ïù¥ÌÑ∞ ÏàòÏã†
            if (event.data && event.data.type === 'response_config') {
                const configData = event.data.payload;
                missionConfig = configData;
                
                console.log('üì¶ Mission Config Î°úÎìú ÏôÑÎ£å:', missionConfig);
                
                // userIdÍ∞Ä Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ ÎØ∏ÏÖò Î°úÎìú
                if (userId) {
                    loadMissions();
                } else {
                    // userId ÏóÜÏúºÎ©¥ ConfigÎßåÏúºÎ°ú Îπà ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
                    renderMissions();
                }
            }
            
            // ÎØ∏ÏÖò UI ÏóÖÎç∞Ïù¥Ìä∏ (API Ìò∏Ï∂ú ÏóÜÏù¥ Îç∞Ïù¥ÌÑ∞Îßå Í∞±Ïã†)
            if (event.data && event.data.type === 'update_mission_ui' && event.data.payload) {
                updateMissionUI(event.data.payload);
            }
        });
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Î∂ÄÎ™® Ï∞ΩÏóê Config ÏöîÏ≤≠
        window.onload = function() {
            window.parent.postMessage({
                type: 'request_config',
                configType: 'mission'
            }, '*');
            
            console.log('üì§ Mission Config ÏöîÏ≤≠ Ï†ÑÏÜ°');
        };

        // ========================================
        // Ïú†Ìã∏Î¶¨Ìã∞
        // ========================================
        
        function showResult(message) {
            const resultBox = document.getElementById('resultBox');
            resultBox.textContent = message;
            resultBox.style.display = 'block';
            setTimeout(() => {
                resultBox.style.display = 'none';
            }, 3000);
        }
        
        // ========================================
        // API Ìï®Ïàò
        // ========================================

        async function loadMissions() {
            if (!userId) {
                showResult('ÌîåÎ†àÏù¥Ïñ¥ IDÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            try {
                showResult('ÎØ∏ÏÖò Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...');
                
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_no: parseInt(userId),
                        api_code: 5001, // ÎØ∏ÏÖò Ï°∞Ìöå API
                        data: {}
                    })
                });
                
                const result = await response.json();
                console.log('üéØ Mission API Response:', result);
                
                if (result.success && result.data) {
                    // Ïú†Ï†Ä ÏßÑÌñâ ÏÉÅÌÉú Ï†ÄÏû•
                    userMissionProgress = result.data;
                    
                    renderMissions();
                    showResult('ÎØ∏ÏÖò Î°úÎìú ÏôÑÎ£å!');
                } else {
                    // Ïã§Ìå® Ïãú Îπà Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî
                    userMissionProgress = {};
                    Object.keys(missionConfig).forEach(missionIdx => {
                        userMissionProgress[missionIdx] = {
                            current_value: 0,
                            is_completed: false,
                            is_claimed: false
                        };
                    });
                    
                    renderMissions();
                    showResult('ÎØ∏ÏÖò Î°úÎìú Ïã§Ìå®: ' + (result.message || 'Í∏∞Î≥∏Í∞íÏúºÎ°ú ÌëúÏãú'));
                }
                
            } catch (error) {
                console.error('ÎØ∏ÏÖò Î°úÎìú ÏóêÎü¨:', error);
                
                // ÏóêÎü¨ Ïãú Îπà Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî
                userMissionProgress = {};
                Object.keys(missionConfig).forEach(missionIdx => {
                    userMissionProgress[missionIdx] = {
                        current_value: 0,
                        is_completed: false,
                        is_claimed: false
                    };
                });
                
                renderMissions();
                showResult('ÎØ∏ÏÖò Î°úÎìú Ïã§Ìå®: ' + error.message);
            }
        }

        function renderMissions() {
            const tableBody = document.getElementById('missionTableBody');
            tableBody.innerHTML = '';
            
            // ConfigÎ•º Î∞∞Ïó¥Î°ú Î≥ÄÌôòÌïòÍ≥† mission_idxÎ°ú Ï†ïÎ†¨
            const missionsArray = Object.values(missionConfig).sort((a, b) => 
                a.mission_idx - b.mission_idx
            );
            
            if (missionsArray.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #999;">ÎØ∏ÏÖò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            let completedCount = 0;
            
            missionsArray.forEach((mission, index) => {
                const missionIdx = mission.mission_idx;
                const userProgress = userMissionProgress[missionIdx] || {
                    current_value: 0,
                    is_completed: false,
                    is_claimed: false
                };
                
                // ÏÑ†Ìñâ ÎØ∏ÏÖò Ï≤¥ÌÅ¨
                const requiredMissions = mission.required_missions ? 
                    mission.required_missions.toString().split(',').map(m => parseInt(m.trim())).filter(m => m) : 
                    [];
                
                let canUnlock = true;
                if (requiredMissions.length > 0) {
                    for (const reqMissionIdx of requiredMissions) {
                        const reqProgress = userMissionProgress[reqMissionIdx];
                        if (!reqProgress || !reqProgress.is_completed || !reqProgress.is_claimed) {
                            canUnlock = false;
                            break;
                        }
                    }
                }
                
                // ÏÉÅÌÉú Í≤∞Ï†ï
                let status = 'locked';
                let statusText = 'üîí Ïû†ÍπÄ';
                let statusClass = 'status-locked';
                let rowClass = 'row-locked';
                
                if (!canUnlock) {
                    status = 'locked';
                } else if (userProgress.is_claimed) {
                    status = 'completed';
                    statusText = '‚úÖ ÏôÑÎ£å';
                    statusClass = 'status-completed';
                    rowClass = 'row-completed';
                    completedCount++;
                } else if (userProgress.is_completed) {
                    status = 'claimable';
                    statusText = 'üéÅ ÏàòÎ†πÍ∞ÄÎä•';
                    statusClass = 'status-claimable';
                    rowClass = '';
                } else {
                    status = 'active';
                    statusText = '‚è≥ ÏßÑÌñâÏ§ë';
                    statusClass = 'status-active';
                    rowClass = '';
                }
                
                // ÏßÑÌñâÎèÑ Í≥ÑÏÇ∞
                const progress = Math.min((userProgress.current_value / mission.value * 100), 100);
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ïÎ≥¥
                const catInfo = categoryInfo[mission.category] || { icon: 'üìã', name: 'Í∏∞ÌÉÄ', class: 'category-building' };
                
                // Î™©Ìëú ÌÖçÏä§Ìä∏ ÏÉùÏÑ±
                let objectiveText = '';
                if (mission.category === 'building') {
                    objectiveText = `Í±¥Î¨º ${mission.target_idx} Lv.${mission.value}`;
                } else if (mission.category === 'research') {
                    objectiveText = `Ïó∞Íµ¨ ${mission.target_idx} Lv.${mission.value}`;
                } else if (mission.category === 'unit') {
                    objectiveText = `Ïú†Îãõ ${mission.target_idx} ${mission.value}Í∞ú`;
                } else if (mission.category === 'hero') {
                    objectiveText = `ÏòÅÏõÖ ${mission.target_idx} ÌöçÎìù`;
                } else {
                    objectiveText = `Î™©Ìëú ${mission.value}`;
                }
                
                // Ìñâ ÏÉùÏÑ±
                const row = document.createElement('tr');
                row.className = rowClass;
                row.dataset.missionIdx = missionIdx;
                row.dataset.status = status;
                
                row.innerHTML = `
                    <td class="mission-number">${index + 1}</td>
                    <td>
                        <div class="mission-info">
                            <div class="mission-title">
                                <span class="category-badge ${catInfo.class}">${catInfo.icon} ${catInfo.name}</span>
                                ${mission.korean_name}
                            </div>
                        </div>
                    </td>
                    <td style="text-align: center; font-size: 11px; color: #666;">
                        ${objectiveText}
                    </td>
                    <td class="progress-cell">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                            <div class="progress-text">${userProgress.current_value}/${mission.value}</div>
                        </div>
                    </td>
                    <td>
                        <div class="rewards-cell">
                            ${Object.entries(mission.reward).map(([itemIdx, amount]) => {
                                const rewardInfo = rewardIcons[itemIdx] || { icon: '‚ùì', name: 'ÏïÑÏù¥ÌÖú' };
                                return `
                                    <div class="reward-item" title="${rewardInfo.name}">
                                        <span class="reward-icon">${rewardInfo.icon}</span>
                                        <span class="reward-amount">${amount.toLocaleString()}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </td>
                    <td class="action-cell">
                        ${status === 'completed' ? 
                            `<button class="claim-btn" disabled>ÏôÑÎ£å</button>` :
                        status === 'claimable' ?
                            `<button class="claim-btn active" onclick="claimReward(${missionIdx})">Î∞õÍ∏∞</button>` :
                        status === 'locked' ?
                            `<span class="status-badge ${statusClass}">${statusText}</span>` :
                            `<span class="status-badge ${statusClass}">${statusText}</span>`
                        }
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ï†ÑÏ≤¥ ÏßÑÌñâÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            updateOverallProgress(completedCount, missionsArray.length);
        }

        function updateOverallProgress(completed, total) {
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalCount').textContent = total;
            const percentage = total > 0 ? (completed / total * 100) : 0;
            document.getElementById('overallProgressBar').style.width = percentage + '%';
        }

        async function claimReward(missionIdx) {
            if (!userId) {
                showResult('ÌîåÎ†àÏù¥Ïñ¥ IDÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }
            
            try {
                showResult('Î≥¥ÏÉÅ ÏàòÎ†π Ï§ë...');
                
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_no: parseInt(userId),
                        api_code: 5002, // ÎØ∏ÏÖò Î≥¥ÏÉÅ ÏàòÎ†π API
                        data: {
                            mission_idx: missionIdx
                        }
                    })
                });
                
                const result = await response.json();
                console.log('üéÅ Claim reward result:', result);
                
                if (result.success) {
                    // Ïú†Ï†Ä ÏßÑÌñâ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    if (userMissionProgress[missionIdx]) {
                        userMissionProgress[missionIdx].is_claimed = true;
                    }
                    
                    renderMissions();
                    showResult('Î≥¥ÏÉÅÏùÑ Î∞õÏïòÏäµÎãàÎã§! üéâ');
                    window.parent.postMessage({ type: 'refresh_item' }, '*');
                } else {
                    showResult('Î≥¥ÏÉÅ ÏàòÎ†π Ïã§Ìå®: ' + (result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
                
            } catch (error) {
                console.error('Î≥¥ÏÉÅ ÏàòÎ†π ÏóêÎü¨:', error);
                showResult('Î≥¥ÏÉÅ ÏàòÎ†π Ïã§Ìå®: ' + error.message);
            }
        }

        // ÌéòÏù¥ÏßÄ ÌôúÏÑ±Ìôî Ïãú Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® (ÏÑ†ÌÉùÏ†Å)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && userId) {
                console.log('üëÄ ÌéòÏù¥ÏßÄ ÌôúÏÑ±Ìôî - ÎØ∏ÏÖò Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®');
                loadMissions();
            }
        });
        
        // ÎØ∏ÏÖò UI Î∂ÄÎ∂Ñ ÏóÖÎç∞Ïù¥Ìä∏ (API Ìò∏Ï∂ú ÏóÜÏù¥)
        function updateMissionUI(missionData) {
            console.log('üîÑ ÎØ∏ÏÖò UI ÏóÖÎç∞Ïù¥Ìä∏:', missionData);
            
            // ÏôÑÎ£åÎêú ÎØ∏ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
            if (missionData.completed && missionData.completed > 0) {
                // checkedÎêú ÎØ∏ÏÖòÎì§Ïùò current_value ÏóÖÎç∞Ïù¥Ìä∏
                Object.keys(userMissionProgress).forEach(missionIdx => {
                    const mission = missionConfig[missionIdx];
                    if (mission && userMissionProgress[missionIdx]) {
                        // ÏôÑÎ£å Ï°∞Í±¥ Ï∂©Ï°± Ïãú is_completed = true
                        if (userMissionProgress[missionIdx].current_value >= mission.value) {
                            userMissionProgress[missionIdx].is_completed = true;
                        }
                    }
                });
            }
            
            renderMissions();  // UIÎßå Îã§Ïãú Í∑∏Î¶º (API Ìò∏Ï∂ú ÏóÜÏùå)
        }
    </script>
</body>
</html>